parameters:
  beanstalkd: tcp://127.0.0.1:11300                         # Beanstalkd connection URI
  http_server_port: 34981                                   # HTTP Server Port
  logger_mail_to: toemail@address.com                       # Email address where to send significant events mail notifications
  logger_mail_from: "From Name <fromemail@address.com>"     # From name/address for significant events mail notifications
  console_port: 8080                                        # Web console port
  console_username: admin                                   # Web console username
  console_password: password                                # Web console password
  console_log_file: /tmp/esb_console.log                    # Web console server log file
  elasticsearch_base_uri: '%env(string:ES_BASE_URI)%'       # ElasticSearch base URI (i.e. http://elasticsearch:9200)

services:
  _defaults:
    autowire: true                  # This is optional (see https://symfony.com/doc/current/service_container/autowiring.html)

  My\Esb\Producer:                  # A producer service definition
    arguments: []

  My\Esb\Worker:                    # A worker service definition
    arguments: []

# Keep the following two services definitions if you are going to enable automatic old jobs cleaning

  Webgriffe\Esb\Producer\CleanOldJobs:
    arguments: ['6 15 * * *']                               # The argument is the crontab expression

  Webgriffe\Esb\Worker\CleanOldJobs:
    arguments: ['@Webgriffe\AmpElasticsearch\Client', 30]     # 30 is the number of day after which a job is considered old and is deleted

flows:
  sample_flow:                      # The flow "code" and will be the Beanstalkd tube name
    description: Sample Flow        # The flow description
    producer:
      service: My\Esb\Producer      # A producer service ID defined above
    worker:
      service: My\Esb\Worker        # A worker service ID defined above
      instances: 1                  # The number of worker instances to spawn for this flow
      release_delay: 0              # The jobs release delay in seconds for this flow (see the Beanstalkd protocol here https://github.com/beanstalkd/beanstalkd/blob/master/doc/protocol.txt)
      max_retry: 5                  # The number of maximum work retries for a job in this tube/flow before being buried

  # Keep the following flow definition to enable automatic old jobs cleaning
  clean_old_jobs_flow:
    description: Cleans jobs for which the last event is older than the given number of days
    producer:
      service: Webgriffe\Esb\Producer\CleanOldJobs
    worker:
      service: Webgriffe\Esb\Worker\CleanOldJobs
